{% extends "blog/base.html"%}
{% load static %}

{%block title%} {{post.title}} {% endblock %}

{%block css_file%} 
 <link rel="stylesheet", href="{% static "blog/post-detail.css"%}">
{%endblock%}


{% block content %}
  <section id="summary">
    {% if edit_rights %}
      <a href="{{post.slug}}/edit" class="btn btn-info">Edit Post</a>
    {% endif %}
    {% if user.is_authenticated %}
      <a href="{%url 'add-tag'%}" class="btn btn-info">Create discussion tag</a>
    {% endif %}
      <h2>{{post.title}}</h2>
      <div>
          {%for tag in tags %}
            <span class="tagged"> {{tag.caption}}</span>
          {% endfor%}
      </div>
      
      <article>
          <img src="{{post.image.url}}" alt="{{post.title}}">
          <address>By {{post.author}}</address>
          <div>Last updated on <time> {{post.date |date:"d M Y" }}</time></div>
      </article>
  </section>

  <main>
      {{post.content}}
      <br>
        <form action="{% url 'like-post' post.slug %}" method="POST">
          {% csrf_token%}
      
          {% if liked%}
              <button type="submit", name="post_id", value="{{post.id}}",
              class="btn btn-danger btn-sm">Unlike</button>
          {% else %}
              <button type="submit", name="post_id", value="{{post.id}}",
              class="btn btn-primary btn-sm">Like</button>
          {% endif%}
              
          
          - {{post.total_likes}} likes 
          <hr>
      </form>
  
      <h2> Comments..</h2>
        {% if not comments.all %}
            No Comments Yet.... <a href="">Add Comment</a>
        {% else %}
            {% for comment in comments.all %}
                <strong>
                    {{comment.commentor.username}} -
                    {{comment.date_added}}
                </strong>
                {{comment.body}}
                
                <form action="{% url 'like-comment' post.slug %}" method="POST">
                  {% csrf_token%}
          
                  {% if liked%}
                      <button type="submit", name="comment_id", value="{{comment.id}}",
                      class="btn btn-danger btn-sm">Unlike</button>
                  {% else %}
                      <button type="submit", name="comment_id", value="{{comment.id}}",
                      class="btn btn-primary btn-sm">Like</button>
                  {% endif%}
                      
                  
                  - {{comment.total_likes}} likes <a href="" class="btn btn-info">Reply</a>
                  <hr>
              </form>
            {% endfor%}
        {% endif %}
          <h2> Add a new comment</h2>
          {% if user.is_authenticated %}
            <div class="row mr-10"> 
              <div class="col-md-6">
                <form method="POST" enctype="multipart/form-data"> 
                  {% csrf_token %}
                  {{formC.as_p}}
                  <button type="submit" class="btn btn-light">Post</button>
              </form>    
              </div>
              <div class="col-md-6">
                
            </div>
          {% else %}
            <div class="row mr-10"> 
              <div class="col-md-6">
                <p>It seems that you are not currently logged in. To leave a comment on the discussion, please first register or login with existing account.</p>
              </div>
              <div class="col-md-6">
                
            </div>
          {% endif %}
  </main>
  
{% endblock %}